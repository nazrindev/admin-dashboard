<div class="order-detail-container">
    <!-- Header -->
    <div class="order-header">
        <div class="header-left">
            <button (click)="goBack()" class="back-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back to Orders
            </button>
            <h1>Order Details</h1>
        </div>
        <div class="header-right" *ngIf="order">
            <span class="order-id">Order #{{ (order._id || '').slice(-8).toUpperCase() }}</span>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Loading order details...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
        <div class="error-content">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
            </svg>
            <h3>Error</h3>
            <p>{{ error }}</p>
            <button (click)="goBack()" class="btn btn-primary">Go Back</button>
        </div>
    </div>

    <!-- Order Content -->
    <div *ngIf="order && !loading" class="order-content">
        <!-- Order Status Section -->
        <div class="order-status-section">
            <div class="status-card">
                <div class="status-header">
                    <h3>Order Status</h3>
                    <span class="status-badge" [class]="getStatusColor(order.status)">
                        {{ order.status | titlecase }}
                    </span>
                </div>
                <div class="status-actions">
                    <button *ngFor="let status of ['processing', 'shipped', 'delivered', 'cancelled']"
                        (click)="updateOrderStatus(status)" [disabled]="order.status === status" class="status-btn"
                        [class.active]="order.status === status">
                        {{ status | titlecase }}
                    </button>
                </div>
            </div>

            <div class="payment-card">
                <h3>Payment Status</h3>
                <span class="payment-badge" [class]="getPaymentStatusColor(order.paymentStatus)">
                    {{ order.paymentStatus | titlecase }}
                </span>
                <p class="payment-method">{{ order.paymentMethod || 'N/A' }}</p>
            </div>
        </div>

        <!-- Order Information Grid -->
        <div class="order-info-grid">
            <!-- Customer Information -->
            <div class="info-card">
                <h3>Customer Information</h3>
                <div class="info-content">
                    <div class="info-item">
                        <label>Name:</label>
                        <span>{{ order.customer?.name || 'N/A' }}</span>
                    </div>
                    <div class="info-item">
                        <label>Email:</label>
                        <span>{{ order.customer?.email || 'N/A' }}</span>
                    </div>
                    <div class="info-item" *ngIf="order.customer?.phone">
                        <label>Phone:</label>
                        <span>{{ order.customer?.phone }}</span>
                    </div>
                </div>
            </div>

            <!-- Shipping Address -->
            <div class="info-card">
                <h3>Shipping Address</h3>
                <div class="info-content">
                    <div class="address-block">
                        <p>{{ order.shippingAddress?.address || 'N/A' }}</p>
                        <p>{{ order.shippingAddress?.city || 'N/A' }}, {{ order.shippingAddress?.state || 'N/A' }} {{
                            order.shippingAddress?.zip || 'N/A' }}</p>
                        <p>{{ order.shippingAddress?.country || 'N/A' }}</p>
                    </div>
                </div>
            </div>

            <!-- Order Timeline -->
            <div class="info-card">
                <h3>Order Timeline</h3>
                <div class="info-content">
                    <div class="info-item">
                        <label>Placed:</label>
                        <span>{{ formatDate(order.placedAt) }}</span>
                    </div>
                    <div class="info-item">
                        <label>Last Updated:</label>
                        <span>{{ formatDate(order.updatedAt) }}</span>
                    </div>
                </div>
            </div>

            <!-- Store Information -->
            <div class="info-card" *ngIf="order.store">
                <h3>Store Information</h3>
                <div class="info-content">
                    <div class="info-item">
                        <label>Store:</label>
                        <span>{{ order.store.name }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Items -->
        <div class="order-items-section">
            <h3>Order Items</h3>
            <div class="items-list">
                <div *ngFor="let item of order.items" class="order-item">
                    <div class="item-image">
                        <img *ngIf="item.product.imageUrls && item.product.imageUrls.length > 0"
                            [src]="item.product.imageUrls[0]" [alt]="item.product.name" class="product-image">
                        <div *ngIf="!item.product.imageUrls || item.product.imageUrls.length === 0" class="no-image">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" />
                                <polyline points="21,15 16,10 5,21" />
                            </svg>
                        </div>
                    </div>

                    <div class="item-details">
                        <h4 class="product-name">{{ item.product.name }}</h4>
                        <p class="product-description" *ngIf="item.product.description">
                            {{ item.product.description }}
                        </p>

                        <!-- Ordered Size -->
                        <div class="ordered-size">
                            <label>Size Ordered:</label>
                            <span class="size-badge ordered" *ngIf="item.size; else noSize">{{ item.size }}</span>
                            <ng-template #noSize>
                                <span class="size-badge no-size">No Size Specified</span>
                            </ng-template>
                        </div>

                        <!-- Available Sizes (for reference) -->
                        <div class="product-sizes" *ngIf="item.product.sizes && item.product.sizes.length > 0">
                            <label>Available Sizes:</label>
                            <div class="sizes-list">
                                <span *ngFor="let size of item.product.sizes" class="size-badge"
                                    [class.ordered]="size === item.size">
                                    {{ size }}
                                </span>
                            </div>
                        </div>

                        <div class="item-quantity">
                            <label>Quantity:</label>
                            <span class="quantity">{{ item.quantity }}</span>
                        </div>
                    </div>

                    <div class="item-pricing">
                        <div class="price-per-unit">
                            <label>Price per unit:</label>
                            <span class="price">${{ item.price }}</span>
                        </div>
                        <div class="total-price">
                            <label>Total:</label>
                            <span class="price">${{ (item.price * item.quantity).toFixed(2) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
            <div class="summary-card">
                <h3>Order Summary</h3>
                <div class="summary-content">
                    <div class="summary-item">
                        <label>Subtotal:</label>
                        <span>${{ ((order.totalAmount || 0) * 0.9).toFixed(2) }}</span>
                    </div>
                    <div class="summary-item">
                        <label>Tax:</label>
                        <span>${{ ((order.totalAmount || 0) * 0.1).toFixed(2) }}</span>
                    </div>
                    <div class="summary-item total">
                        <label>Total Amount:</label>
                        <span>${{ (order.totalAmount || 0).toFixed(2) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>