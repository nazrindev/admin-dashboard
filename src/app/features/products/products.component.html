<!-- Header section for main content -->
<div class="flex justify-between items-center mb-6">
	<h1 class="text-2xl font-bold text-gray-900">Products</h1>
	<button (click)="openCreatePopup()"
		class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2">
		+ Add Product
	</button>
</div>

<!-- Search -->
<div class="mb-6">
	<div class="relative">
		<input type="text" [(ngModel)]="searchTerm" (keyup.enter)="searchProducts()" placeholder="Search products..."
			class="w-full pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200">
		<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
			<svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
					d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
			</svg>
		</div>
		<button (click)="searchProducts()" class="absolute inset-y-0 right-0 pr-3 flex items-center">
			<span class="bg-orange-600 text-white px-3 py-1 rounded text-sm hover:bg-orange-700">Search</span>
		</button>
	</div>
</div>

<!-- Create Product Modal -->
<div *ngIf="openCreateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
	<div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
		<!-- Modal Header -->
		<div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10">
			<h3 class="text-xl font-semibold text-gray-900">Create New Product</h3>
			<button (click)="closeCreatePopup()" class="text-gray-500 hover:text-gray-700">
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
				</svg>
			</button>
		</div>

		<!-- Form Content -->
		<form [formGroup]="productForm" (ngSubmit)="submitProduct()" class="p-6">
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<!-- Left Column: Basic Info -->
				<div class="space-y-6">
					<!-- Image Upload Section -->
					<div class="space-y-4">
						<label class="block text-sm font-medium text-gray-700">Product Images</label>
						<div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-orange-400 transition-colors relative group cursor-pointer"
							(click)="fileInput.click()" (dragover)="onDragOver($event)"
							(dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
							<input #fileInput id="file-upload" type="file" (change)="onImageSelected($event)" multiple
								accept="image/*,.png,.jpg,.jpeg,.gif,.webp" class="hidden" />
							<label for="file-upload" class="cursor-pointer block">
								<div class="space-y-2">
									<svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none"
										viewBox="0 0 48 48">
										<path
											d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
											stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
									</svg>
									<div class="text-sm text-gray-600">
										<span class="font-medium text-orange-600 hover:text-orange-500">Click to
											upload</span>
										or drag and drop images here
									</div>
									<p class="text-xs text-gray-500">PNG, JPG, JPEG, GIF, WebP up to 10MB each</p>
									<p class="text-xs text-blue-600">Multiple files supported</p>
								</div>
							</label>
							<!-- Hover Overlay -->
							<div
								class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-5 rounded-lg transition-all duration-200">
							</div>
						</div>

						<!-- Image Previews -->
						<div *ngIf="selectedImages.length > 0" class="grid grid-cols-3 gap-4">
							<div *ngFor="let url of previewUrls; let i = index" class="relative group">
								<img [src]="url" class="w-full h-32 object-cover rounded-lg" />
								<button type="button" (click)="removeImage(selectedImages[i])"
									class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M6 18L18 6M6 6l12 12" />
									</svg>
								</button>
							</div>
						</div>

					</div>

					<!-- Basic Info Fields -->
					<div class="space-y-4">
						<div>
							<label class="block text-sm font-medium text-gray-700">Product Name *</label>
							<input type="text" formControlName="name" placeholder="Enter product name"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
						</div>

						<div class="grid grid-cols-2 gap-4">
							<div>
								<label class="block text-sm font-medium text-gray-700">Price *</label>
								<div class="mt-1 relative rounded-md shadow-sm">
									<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
										<span class="text-gray-500 sm:text-sm">$</span>
									</div>
									<input type="number" formControlName="price" placeholder="0.00" step="0.01"
										class="block w-full pl-7 px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200" />
								</div>
							</div>

							<div>
								<label class="block text-sm font-medium text-gray-700">Stock *</label>
								<input type="number" formControlName="stock" placeholder="Quantity"
									class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
							</div>
						</div>

						<div>
							<label class="block text-sm font-medium text-gray-700">Category</label>
							<select formControlName="categoryId"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500">
								<option [ngValue]="null">Select Category</option>
								<option *ngFor="let category of categories" [value]="category._id">
									{{ category.name }}
								</option>
							</select>
						</div>
					</div>
				</div>

				<!-- Right Column: Additional Info -->
				<div class="space-y-6">
					<div>
						<label class="block text-sm font-medium text-gray-700">Description</label>
						<textarea formControlName="description" rows="3" placeholder="Product description"
							class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 resize-none text-gray-900 placeholder-gray-500"></textarea>
					</div>

					<!-- Toggle for Advanced Options -->
					<div>
						<button type="button" (click)="showAdvancedOptions = !showAdvancedOptions"
							class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
							<svg [class.rotate-90]="showAdvancedOptions"
								class="mr-2 h-4 w-4 transition-transform duration-200" fill="none" stroke="currentColor"
								viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M9 5l7 7-7 7" />
							</svg>
							{{ showAdvancedOptions ? 'Hide' : 'Show' }} Advanced Options
						</button>
					</div>

					<!-- Advanced Options -->
					<div *ngIf="showAdvancedOptions" class="space-y-4">
						<div>
							<label class="block text-sm font-medium text-gray-700">SKU</label>
							<input type="text" formControlName="sku" placeholder="Stock Keeping Unit"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
						</div>

						<div>
							<label class="block text-sm font-medium text-gray-700">Brand</label>
							<input type="text" formControlName="brand" placeholder="Brand name"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
						</div>

						<div class="grid grid-cols-2 gap-4">
							<div>
								<label class="block text-sm font-medium text-gray-700">Gender</label>
								<select formControlName="gender"
									class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500">
									<option [ngValue]="null">Select Gender</option>
									<option value="Men">Men</option>
									<option value="Women">Women</option>
									<option value="Unisex">Unisex</option>
								</select>
							</div>

							<div>
								<label class="block text-sm font-medium text-gray-700">Occasion</label>
								<input type="text" formControlName="occasion" placeholder="e.g., Casual, Formal"
									class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
							</div>
						</div>

						<div>
							<label class="block text-sm font-medium text-gray-700">Material</label>
							<input type="text" formControlName="material" placeholder="e.g., Cotton, Polyester"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
						</div>

						<div>
							<label class="block text-sm font-medium text-gray-700">Sizes</label>
							<input type="text" formControlName="sizes" placeholder="S, M, L, XL (comma-separated)"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
						</div>

						<div>
							<label class="block text-sm font-medium text-gray-700">Colors</label>
							<input type="text" formControlName="color" placeholder="Red, Blue, Green (comma-separated)"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
						</div>

						<div>
							<label class="block text-sm font-medium text-gray-700">Tags</label>
							<input type="text" formControlName="tags"
								placeholder="summer, casual, trendy (comma-separated)"
								class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors duration-200 text-gray-900 placeholder-gray-500" />
						</div>

						<div class="flex items-center">
							<input type="checkbox" formControlName="isActive" id="isActive"
								class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded" />
							<label for="isActive" class="ml-2 block text-sm text-gray-900">
								Product is active and visible to customers
							</label>
						</div>
					</div>
				</div>
			</div>

			<!-- Form Messages -->
			<div class="mt-6">
				<div *ngIf="errorMessage" class="p-4 bg-red-50 border-l-4 border-red-400 text-red-700">
					{{ errorMessage }}
				</div>
				<div *ngIf="successMessage" class="p-4 bg-green-50 border-l-4 border-green-400 text-green-700">
					{{ successMessage }}
				</div>
			</div>

			<!-- Form Actions -->
			<div class="mt-6 flex justify-end gap-3">
				<button type="button" (click)="closeCreatePopup()"
					class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
					Cancel
				</button>
				<button type="submit"
					class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50"
					[disabled]="isSubmitting">
					<span *ngIf="isSubmitting" class="inline-flex items-center">
						<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
							<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
							</circle>
							<path class="opacity-75" fill="currentColor"
								d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
							</path>
						</svg>
						Creating...
					</span>
					<span *ngIf="!isSubmitting">Create Product</span>
				</button>
			</div>
		</form>
	</div>
</div>

<!-- Products List with Pagination -->
<div class="mt-8">
	<!-- Products Table -->
	<div class="overflow-x-auto">
		<table class="min-w-full divide-y divide-gray-200">
			<thead class="bg-gray-50">
				<tr>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image
					</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price
					</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock
					</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status
					</th>
					<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions
					</th>
				</tr>
			</thead>
			<tbody class="bg-white divide-y divide-gray-200">
				<tr *ngFor="let product of products">
					<td class="px-6 py-4 whitespace-nowrap">
						<img [src]="product.imageUrls?.[0] || '/assets/placeholder.png'"
							(click)="openImagePopup(product.imageUrls?.[0])"
							class="h-12 w-12 object-cover rounded cursor-pointer hover:opacity-75" />
					</td>
					<td class="px-6 py-4">
						<div class="text-sm font-medium text-gray-900">{{ product.name }}</div>
						<div class="text-sm text-gray-500">SKU: {{ product.sku || 'N/A' }}</div>
					</td>
					<td class="px-6 py-4 whitespace-nowrap">
						<div class="text-sm text-gray-900">${{ product.price }}</div>
					</td>
					<td class="px-6 py-4 whitespace-nowrap">
						<input type="number" [(ngModel)]="product.stock" (blur)="saveStock(product)"
							class="w-20 px-2 py-1 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-orange-500" />
					</td>
					<td class="px-6 py-4 whitespace-nowrap">
						<label class="inline-flex items-center cursor-pointer">
							<input type="checkbox" [(ngModel)]="product.isActive" (change)="saveActive(product)"
								class="form-checkbox h-4 w-4 text-orange-600 transition duration-150 ease-in-out" />
							<span class="ml-2 text-sm text-gray-600">
								{{ product.isActive ? 'Active' : 'Inactive' }}
							</span>
						</label>
					</td>
					<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
						<button (click)="openEditPopup(product)"
							class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
						<button (click)="deleteProduct(product)" class="text-red-600 hover:text-red-900">Delete</button>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- Pagination Info (Debug) -->
	<div class="mt-2 text-sm text-gray-600 text-center">
		Showing {{ products.length }} of {{ totalItems }} products (Page {{ currentPage }} of {{ totalPages }}, {{
		itemsPerPage }} per page)
	</div>

	<!-- Pagination -->
	<div class="mt-4">
		<app-pagination [currentPage]="currentPage" [totalItems]="totalItems" [itemsPerPage]="itemsPerPage"
			(pageChange)="onPageChange($event)">
		</app-pagination>
	</div>
</div>

<!-- Image Preview Modal -->
<div *ngIf="popupImageUrl" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
	<div class="relative bg-white p-2 rounded-lg max-w-3xl max-h-[90vh]">
		<button (click)="closeImagePopup()"
			class="absolute -top-3 -right-3 bg-red-500 text-white rounded-full p-1 hover:bg-red-600">
			<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
			</svg>
		</button>
		<img [src]="popupImageUrl" class="max-h-[85vh] rounded-lg" />
	</div>
</div>