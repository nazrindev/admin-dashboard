<div class="stores-container">
    <!-- Success/Error Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-error">
        {{ errorMessage }}
    </div>

    <!-- Header -->
    <div class="page-header">
        <h2>Store Management</h2>
        <p class="page-description">Manage your stores and featured status</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading stores...</p>
    </div>

    <!-- Stores List -->
    <div *ngIf="!loading && stores && stores.length > 0" class="stores-grid">
        <div *ngFor="let store of stores" class="store-card" [class.featured]="store.featured"
            [class.expired]="isFeaturedExpired(store)">
            <!-- Store Header -->
            <div class="store-header">
                <div class="store-logo">
                    <img [src]="store.logo || 'assets/placeholder-store.png'" [alt]="store.businessName" />
                </div>
                <div class="store-info">
                    <h3>{{ store.businessName }}</h3>
                    <p class="store-type">{{ store.type || 'General Store' }}</p>
                    <div class="store-badges">
                        <span *ngIf="store.verified" class="badge verified">Verified</span>
                        <span *ngIf="store.featured" class="badge featured" [class.expired]="isFeaturedExpired(store)">
                            {{ isFeaturedExpired(store) ? 'Featured (Expired)' : 'Featured' }}
                        </span>
                        <!-- Subscription Badges -->
                        <span *ngIf="hasSubscription(store) && isSubscriptionExpired(store)" class="badge subscription-expired">
                            Subscription Expired
                        </span>
                        <span *ngIf="hasSubscription(store) && !isSubscriptionExpired(store)" class="badge subscription-active">
                            Subscription Ends: {{ formatDate(store.subscriptionExpiry!) }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Store Details -->
            <div class="store-details">
                <div class="detail-row">
                    <span class="label">Address:</span>
                    <span class="value">{{ store.address || 'Not provided' }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Phone:</span>
                    <span class="value">{{ store.phone || 'Not provided' }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Rating:</span>
                    <span class="value">{{ store.rating }}/5 ‚≠ê</span>
                </div>
                <div class="detail-row">
                    <span class="label">Delivery:</span>
                    <span class="value">
                        <span *ngIf="store.supportDelivery" class="delivery-option">Home Delivery</span>
                        <span *ngIf="store.sameDayDelivery" class="delivery-option">Same Day</span>
                        <span *ngIf="!store.supportDelivery && !store.sameDayDelivery">Not Available</span>
                    </span>
                </div>
                <div *ngIf="store.featured && store.featuredExpiry" class="detail-row">
                    <span class="label">Featured Until:</span>
                    <span class="value" [class.expired]="isFeaturedExpired(store)">
                        {{ formatDate(store.featuredExpiry) }}
                    </span>
                </div>
                <!-- Subscription Info -->
                <div *ngIf="hasSubscription(store)" class="detail-row subscription-info">
                    <span class="label">Subscription:</span>
                    <span class="value" [class.expired]="isSubscriptionExpired(store)">
                        <span *ngIf="isSubscriptionExpired(store)">Expired</span>
                        <span *ngIf="!isSubscriptionExpired(store)">
                            Ends in {{ getDaysUntilExpiry(store) }} day(s)
                        </span>
                    </span>
                </div>
            </div>

            <!-- Store Status Display -->
            <div class="store-status">
                <div class="status-display" [class.featured]="store.featured"
                    [class.expired]="isFeaturedExpired(store)">
                    <span *ngIf="!store.featured" class="status-text">Not Featured</span>
                    <span *ngIf="store.featured && !isFeaturedExpired(store)" class="status-text">Featured</span>
                    <span *ngIf="store.featured && isFeaturedExpired(store)" class="status-text">Featured
                        (Expired)</span>
                </div>
                <div *ngIf="store.featured && store.featuredExpiry" class="expiry-info">
                    <small>Expires: {{ formatDate(store.featuredExpiry) }}</small>
                </div>
            </div>

            <!-- Subscription Renewal Section -->
            <div *ngIf="hasSubscription(store)" class="subscription-renewal">
                <div *ngIf="isSubscriptionExpired(store)" class="renewal-alert expired">
                    <p>Your subscription has expired. Please renew to continue using premium features.</p>
                    <button class="btn-renew" (click)="onRenewClick(store)">Click Here to Renew</button>
                </div>
                <div *ngIf="!isSubscriptionExpired(store)" class="renewal-alert active">
                    <p>Subscription ends on {{ formatDate(store.subscriptionExpiry!) }}</p>
                    <button class="btn-renew" (click)="onRenewClick(store)">Renew Now</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && (!stores || stores.length === 0)" class="empty-state">
        <div class="empty-icon">üè™</div>
        <h3>No stores found</h3>
        <p>You haven't created any stores yet.</p>
    </div>
</div>

<!-- Invoice Modal -->
<div *ngIf="showInvoiceModal && selectedStoreForRenewal" class="invoice-modal-overlay" (click)="closeInvoiceModal()">
    <div class="invoice-modal-content" (click)="$event.stopPropagation()">
        <div class="invoice-header">
            <h3>Subscription Renewal Invoice</h3>
            <button class="close-btn" (click)="closeInvoiceModal()">&times;</button>
        </div>
        <div class="invoice-body">
            <div class="invoice-store-info">
                <h4>{{ selectedStoreForRenewal.businessName }}</h4>
                <p class="store-type">{{ selectedStoreForRenewal.type || 'General Store' }}</p>
            </div>
            <div class="invoice-details">
                <div class="invoice-row">
                    <span class="invoice-label">Subscription Plan:</span>
                    <span class="invoice-value">Monthly Subscription</span>
                </div>
                <div class="invoice-row">
                    <span class="invoice-label">Amount:</span>
                    <span class="invoice-value amount">‚Çπ{{ selectedStoreForRenewal.subscriptionAmount }}</span>
                </div>
                <div class="invoice-row">
                    <span class="invoice-label">Duration:</span>
                    <span class="invoice-value">1 Month</span>
                </div>
                <div *ngIf="selectedStoreForRenewal.subscriptionExpiry" class="invoice-row">
                    <span class="invoice-label">Current Expiry:</span>
                    <span class="invoice-value">{{ formatDate(selectedStoreForRenewal.subscriptionExpiry) }}</span>
                </div>
            </div>
            <div class="invoice-total">
                <div class="total-row">
                    <span class="total-label">Total Amount:</span>
                    <span class="total-value">‚Çπ{{ selectedStoreForRenewal.subscriptionAmount }}</span>
                </div>
            </div>
        </div>
        <div class="invoice-footer">
            <button class="btn-cancel" (click)="closeInvoiceModal()">Cancel</button>
            <button class="btn-proceed" (click)="proceedToPayment()">Proceed to Payment</button>
        </div>
    </div>
</div>

<!-- Approval functionality moved to super admin panel -->